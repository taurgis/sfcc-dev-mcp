# ==================================================================================
# SFCC MCP Server - search_best_practices Tool YAML Tests
# Tests deprecation notice functionality - tools now return deprecation notices
# pointing users to GitHub Copilot Agent Skills
#
# Quick Test Commands:
# aegis "tests/mcp/yaml/search-best-practices.full-mode.test.mcp.yml" --config "aegis.config.json.json" --verbose
# ==================================================================================
description: "SFCC MCP Server search_best_practices tool - deprecation notice validation (full-mode)"

tests:
  - it: "should list search_best_practices tool in available tools"
    request:
      jsonrpc: "2.0"
      id: "tool-list-1"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "tool-list-1"
        result:
          tools:
            match:arrayContains:name:search_best_practices
      stderr: "toBeEmpty"

  - it: "should return deprecation notice when searching"
    request:
      jsonrpc: "2.0"
      id: "deprecation-1"
      method: "tools/call"
      params:
        name: "search_best_practices"
        arguments:
          query: "caching"
    expect:
      response:
        jsonrpc: "2.0"
        id: "deprecation-1"
        result:
          content:
            - type: "text"
              text: "match:contains:DEPRECATION NOTICE"
          isError: false
      stderr: "toBeEmpty"

  - it: "should mention GitHub Copilot Agent Skills in deprecation notice"
    request:
      jsonrpc: "2.0"
      id: "deprecation-skills-1"
      method: "tools/call"
      params:
        name: "search_best_practices"
        arguments:
          query: "validation"
    expect:
      response:
        jsonrpc: "2.0"
        id: "deprecation-skills-1"
        result:
          content:
            - type: "text"
              text: "match:contains:Agent Skills"
          isError: false
      stderr: "toBeEmpty"

  - it: "should include skills directory path in deprecation notice"
    request:
      jsonrpc: "2.0"
      id: "deprecation-url-1"
      method: "tools/call"
      params:
        name: "search_best_practices"
        arguments:
          query: "security"
    expect:
      response:
        jsonrpc: "2.0"
        id: "deprecation-url-1"
        result:
          content:
            - type: "text"
              text: "match:contains:ai-instructions/skills"
          isError: false
      stderr: "toBeEmpty"

  - it: "should respond quickly with deprecation notice"
    request:
      jsonrpc: "2.0"
      id: "deprecation-perf-1"
      method: "tools/call"
      params:
        name: "search_best_practices"
        arguments:
          query: "performance"
    expect:
      response:
        jsonrpc: "2.0"
        id: "deprecation-perf-1"
        result:
          content:
            - type: "text"
              text: "match:type:string"
          isError: false
      performance:
        maxResponseTime: "300ms"
      stderr: "toBeEmpty"
