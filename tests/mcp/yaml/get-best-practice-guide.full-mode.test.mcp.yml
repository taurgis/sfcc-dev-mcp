# ==================================================================================
# SFCC MCP Server - get_best_practice_guide Tool YAML Tests
# Tests deprecation notice functionality - tools now return deprecation notices
# pointing users to GitHub Copilot Agent Skills
#
# Quick Test Commands:
# aegis "tests/mcp/yaml/get-best-practice-guide.full-mode.test.mcp.yml" --config "aegis.config.json.json" --verbose
# ==================================================================================
description: "SFCC MCP Server get_best_practice_guide tool - deprecation notice validation (full-mode)"

tests:
  - it: "should list get_best_practice_guide tool in available tools"
    request:
      jsonrpc: "2.0"
      id: "tool-list-1"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "tool-list-1"
        result:
          tools:
            match:arrayContains:name:get_best_practice_guide
      stderr: "toBeEmpty"

  - it: "should return deprecation notice for cartridge_creation guide"
    request:
      jsonrpc: "2.0"
      id: "deprecation-cartridge-1"
      method: "tools/call"
      params:
        name: "get_best_practice_guide"
        arguments:
          guideName: "cartridge_creation"
    expect:
      response:
        jsonrpc: "2.0"
        id: "deprecation-cartridge-1"
        result:
          content:
            - type: "text"
              text: "match:contains:DEPRECATION NOTICE"
          isError: false
      stderr: "toBeEmpty"

  - it: "should point to sfcc-cartridge-development skill for cartridge_creation"
    request:
      jsonrpc: "2.0"
      id: "deprecation-cartridge-skill-1"
      method: "tools/call"
      params:
        name: "get_best_practice_guide"
        arguments:
          guideName: "cartridge_creation"
    expect:
      response:
        jsonrpc: "2.0"
        id: "deprecation-cartridge-skill-1"
        result:
          content:
            - type: "text"
              text: "match:contains:sfcc-cartridge-development"
          isError: false
      stderr: "toBeEmpty"

  - it: "should return deprecation notice for sfra_controllers guide"
    request:
      jsonrpc: "2.0"
      id: "deprecation-sfra-1"
      method: "tools/call"
      params:
        name: "get_best_practice_guide"
        arguments:
          guideName: "sfra_controllers"
    expect:
      response:
        jsonrpc: "2.0"
        id: "deprecation-sfra-1"
        result:
          content:
            - type: "text"
              text: "match:contains:DEPRECATION NOTICE"
          isError: false
      stderr: "toBeEmpty"

  - it: "should point to sfcc-sfra-controllers skill for sfra_controllers"
    request:
      jsonrpc: "2.0"
      id: "deprecation-sfra-skill-1"
      method: "tools/call"
      params:
        name: "get_best_practice_guide"
        arguments:
          guideName: "sfra_controllers"
    expect:
      response:
        jsonrpc: "2.0"
        id: "deprecation-sfra-skill-1"
        result:
          content:
            - type: "text"
              text: "match:contains:sfcc-sfra-controllers"
          isError: false
      stderr: "toBeEmpty"

  - it: "should return deprecation notice for security guide"
    request:
      jsonrpc: "2.0"
      id: "deprecation-security-1"
      method: "tools/call"
      params:
        name: "get_best_practice_guide"
        arguments:
          guideName: "security"
    expect:
      response:
        jsonrpc: "2.0"
        id: "deprecation-security-1"
        result:
          content:
            - type: "text"
              text: "match:contains:sfcc-security"
          isError: false
      stderr: "toBeEmpty"

  - it: "should respond quickly with deprecation notice"
    request:
      jsonrpc: "2.0"
      id: "deprecation-perf-1"
      method: "tools/call"
      params:
        name: "get_best_practice_guide"
        arguments:
          guideName: "performance"
    expect:
      response:
        jsonrpc: "2.0"
        id: "deprecation-perf-1"
        result:
          content:
            - type: "text"
              text: "match:type:string"
          isError: false
      performance:
        maxResponseTime: "300ms"
      stderr: "toBeEmpty"
