# ==================================================================================
# SFCC MCP Server - get_hook_reference Tool YAML Tests
# Tests deprecation notice functionality - tools now return deprecation notices
# pointing users to GitHub Copilot Agent Skills
#
# Quick Test Commands:
# aegis "tests/mcp/yaml/get-hook-reference.full-mode.test.mcp.yml" --config "aegis.config.json.json" --verbose
# ==================================================================================
description: "SFCC MCP Server get_hook_reference tool - deprecation notice validation (full-mode)"

tests:
  - it: "should list get_hook_reference tool in available tools"
    request:
      jsonrpc: "2.0"
      id: "tool-list-1"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "tool-list-1"
        result:
          tools:
            match:arrayContains:name:get_hook_reference
      stderr: "toBeEmpty"

  - it: "should return deprecation notice for ocapi_hooks"
    request:
      jsonrpc: "2.0"
      id: "deprecation-ocapi-1"
      method: "tools/call"
      params:
        name: "get_hook_reference"
        arguments:
          guideName: "ocapi_hooks"
    expect:
      response:
        jsonrpc: "2.0"
        id: "deprecation-ocapi-1"
        result:
          content:
            - type: "text"
              text: "match:contains:DEPRECATION NOTICE"
          isError: false
      stderr: "toBeEmpty"

  - it: "should point to sfcc-ocapi-hooks skill for ocapi_hooks"
    request:
      jsonrpc: "2.0"
      id: "deprecation-ocapi-skill-1"
      method: "tools/call"
      params:
        name: "get_hook_reference"
        arguments:
          guideName: "ocapi_hooks"
    expect:
      response:
        jsonrpc: "2.0"
        id: "deprecation-ocapi-skill-1"
        result:
          content:
            - type: "text"
              text: "match:contains:sfcc-ocapi-hooks"
          isError: false
      stderr: "toBeEmpty"

  - it: "should return deprecation notice for scapi_hooks"
    request:
      jsonrpc: "2.0"
      id: "deprecation-scapi-1"
      method: "tools/call"
      params:
        name: "get_hook_reference"
        arguments:
          guideName: "scapi_hooks"
    expect:
      response:
        jsonrpc: "2.0"
        id: "deprecation-scapi-1"
        result:
          content:
            - type: "text"
              text: "match:contains:DEPRECATION NOTICE"
          isError: false
      stderr: "toBeEmpty"

  - it: "should point to sfcc-scapi-hooks skill for scapi_hooks"
    request:
      jsonrpc: "2.0"
      id: "deprecation-scapi-skill-1"
      method: "tools/call"
      params:
        name: "get_hook_reference"
        arguments:
          guideName: "scapi_hooks"
    expect:
      response:
        jsonrpc: "2.0"
        id: "deprecation-scapi-skill-1"
        result:
          content:
            - type: "text"
              text: "match:contains:sfcc-scapi-hooks"
          isError: false
      stderr: "toBeEmpty"

  - it: "should respond quickly with deprecation notice"
    request:
      jsonrpc: "2.0"
      id: "deprecation-perf-1"
      method: "tools/call"
      params:
        name: "get_hook_reference"
        arguments:
          guideName: "ocapi_hooks"
    expect:
      response:
        jsonrpc: "2.0"
        id: "deprecation-perf-1"
        result:
          content:
            - type: "text"
              text: "match:type:string"
          isError: false
      performance:
        maxResponseTime: "300ms"
      stderr: "toBeEmpty"
