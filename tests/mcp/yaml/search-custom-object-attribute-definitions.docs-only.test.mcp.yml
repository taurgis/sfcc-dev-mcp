description: "Tests for search_custom_object_attribute_definitions tool in docs-only mode"
# Run with: npx aegis "tests/mcp/yaml/search-custom-object-attribute-definitions.docs-only.test.mcp.yml" --config ./aegis.config.docs-only.json

tests:
  # Docs-Only Mode Tests (tool not configured)
  - it: "should return configuration error in docs-only mode"
    request:
      jsonrpc: "2.0"
      method: "tools/call"
      id: 1
      params:
        name: "search_custom_object_attribute_definitions"
        arguments:
          objectType: "VersionHistory"
          searchRequest:
            query:
              match_all_query: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: 1
        result:
          content:
            match:arrayElements:
              match:partial:
                type: "text"
                text: "match:contains:OCAPI client not configured"
          isError: true
      stderr: "toBeEmpty"
      performance:
        maxResponseTime: "500ms"

  - it: "should handle error gracefully with minimal parameters in docs-only mode"
    request:
      jsonrpc: "2.0"
      method: "tools/call"
      id: 2
      params:
        name: "search_custom_object_attribute_definitions"
        arguments:
          objectType: "CustomAPI"
    expect:
      response:
        jsonrpc: "2.0"
        id: 2
        result:
          content:
            match:arrayElements:
              match:partial:
                type: "text"
                text: "match:contains:OCAPI client not configured"
          isError: true
      stderr: "toBeEmpty"
      performance:
        maxResponseTime: "500ms"

  - it: "should return OCAPI client not configured error even with invalid parameters"
    request:
      jsonrpc: "2.0"
      method: "tools/call"
      id: 3
      params:
        name: "search_custom_object_attribute_definitions"
        arguments:
          objectType: ""
          searchRequest:
            query:
              match_all_query: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: 3
        result:
          content:
            match:arrayElements:
              match:partial:
                type: "text"
                text: "match:contains:OCAPI client not configured"
          isError: true
      stderr: "toBeEmpty"
      performance:
        maxResponseTime: "500ms"